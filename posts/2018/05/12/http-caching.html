<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP Caching - HTTP 缓存 | Meteorlxy</title>
    <meta name="description" content="Note about HTTP Caching - 关于HTTP缓存的相关内容整理">
    <link rel="icon" href="/assets/img/avatar.jpg">
    <link rel="preload" href="/assets/css/3.styles.1dac5719.css" as="style"><link rel="preload" href="/assets/js/vendor.2.1dac5719.js" as="script"><link rel="preload" href="/assets/js/vendor.1.27c1b491.js" as="script"><link rel="preload" href="/assets/css/0.styles.85f8c959.css" as="style"><link rel="preload" href="/assets/js/vendor.0.85f8c959.js" as="script"><link rel="preload" href="/assets/js/app.d3b3b19c.js" as="script"><link rel="preload" href="/assets/js/6.203a490e.js" as="script"><link rel="prefetch" href="/assets/css/4.styles.1f761703.css"><link rel="prefetch" href="/assets/js/10.5880b135.js"><link rel="prefetch" href="/assets/js/11.db5e2ccd.js"><link rel="prefetch" href="/assets/js/12.010128d0.js"><link rel="prefetch" href="/assets/js/13.f279abaf.js"><link rel="prefetch" href="/assets/js/14.55a39220.js"><link rel="prefetch" href="/assets/js/15.f239dde7.js"><link rel="prefetch" href="/assets/js/16.84da3b21.js"><link rel="prefetch" href="/assets/js/17.0ee24ab6.js"><link rel="prefetch" href="/assets/js/18.7dedf05f.js"><link rel="prefetch" href="/assets/js/19.c4c7b1d3.js"><link rel="prefetch" href="/assets/js/20.1d12d024.js"><link rel="prefetch" href="/assets/js/4.1f761703.js"><link rel="prefetch" href="/assets/js/5.bdd7c5b3.js"><link rel="prefetch" href="/assets/js/7.77641c2f.js"><link rel="prefetch" href="/assets/js/8.394fd8aa.js"><link rel="prefetch" href="/assets/js/9.ff38e315.js">
    <link rel="stylesheet" href="/assets/css/3.styles.1dac5719.css"><link rel="stylesheet" href="/assets/css/0.styles.85f8c959.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" data-v-0be91240><div data-v-740e207b data-v-0be91240><nav class="navbar" data-v-740e207b><div class="container" data-v-740e207b><a href="/" class="router-link-active" data-v-740e207b><span class="navbar-site-name" data-v-740e207b>
          Meteorlxy
        </span></a> <div class="navbar-toggler" data-v-740e207b><svg class="icon" style="font-size:1.2em;" data-v-740e207b data-v-740e207b><title data-v-740e207b data-v-740e207b>menu</title><use xlink:href="#icon-menu" data-v-740e207b data-v-740e207b></use></svg></div> <div class="navbar-links" data-v-740e207b><a href="/" class="navbar-link" data-v-740e207b>
            Home
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-740e207b>
            Posts
          </a><a href="/projects/" class="navbar-link" data-v-740e207b>
            Projects
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-740e207b></div></div> <div class="banner" data-v-98d6aa8c data-v-0be91240 data-v-0be91240><div class="container" data-v-98d6aa8c><div class="center" data-v-98d6aa8c><h1 data-v-98d6aa8c data-v-0be91240>
          HTTP Caching - HTTP 缓存
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-6e91a59a data-v-6e91a59a><main class="main" data-v-6e91a59a><div class="post" data-v-6e91a59a data-v-6e91a59a><section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2018-05-12
    </span> <!----></section> <section class="post-links" data-v-4e23451f><a href="/posts/2018/05/09/hello-world.html" class="post-link" data-v-4e23451f>
      上一篇 : Hello, World!
    </a> <a href="/posts/2018/06/06/internship-of-2018.html" class="post-link" data-v-4e23451f>
      下一篇 : 2018年互联网公司暑期实习笔试面试经历
    </a></section></section> <article class="main-div"><div class="post-content content content__default"><p>缓存对于前端性能优化等方面都有着重要意义。这篇把HTTP缓存相关的知识点总在这里，部分内容自己重新描述了一下，加深理解。</p> <div class="custom-block warning"><p class="custom-block-title">TODOS</p> <ul><li>RFC2616 Capter 13: Caching in HTTP</li></ul></div> <h1 id="http-caching-http-缓存"><a href="#http-caching-http-缓存" class="header-anchor">#</a> HTTP Caching - HTTP 缓存</h1> <div><ul><li><a href="/posts/2018/05/12/http-caching.html#可能进行缓存的内容">可能进行缓存的内容</a></li><li><a href="/posts/2018/05/12/http-caching.html#缓存类型">缓存类型</a></li><li><a href="/posts/2018/05/12/http-caching.html#缓存控制">缓存控制</a><ul><li><a href="/posts/2018/05/12/http-caching.html#related-http-headers">Related HTTP Headers</a></li><li><a href="/posts/2018/05/12/http-caching.html#expiration-model-todo">Expiration Model [TODO]</a></li><li><a href="/posts/2018/05/12/http-caching.html#validation-model-todo">Validation Model [TODO]</a></li></ul></li><li><a href="/posts/2018/05/12/http-caching.html#references">References</a></li><li><a href="/posts/2018/05/12/http-caching.html#写在后面">写在后面</a></li></ul></div> <h2 id="可能进行缓存的内容"><a href="#可能进行缓存的内容" class="header-anchor">#</a> 可能进行缓存的内容</h2> <ul><li><code>GET</code>请求的<code>200 OK</code>响应，可能是HTML文档、图片、文件等资源。</li> <li><code>301 Moved Permanently</code></li> <li><code>404 Not Found</code></li> <li><code>206 Partial Content</code></li> <li><code>GET</code>请求以外的、定义了<code>cache key</code>的内容</li></ul> <h2 id="缓存类型"><a href="#缓存类型" class="header-anchor">#</a> 缓存类型</h2> <ul><li>私有 <code>private</code>：只能被特定用户使用，比如浏览器缓存</li> <li>公有/共享 <code>public</code>/<code>shared</code>：可以被多个用户使用，比如代理缓存、CDN缓存等</li></ul> <h2 id="缓存控制"><a href="#缓存控制" class="header-anchor">#</a> 缓存控制</h2> <h3 id="related-http-headers"><a href="#related-http-headers" class="header-anchor">#</a> Related HTTP Headers</h3> <ul><li><code>Age</code></li> <li><a href="#cache-control-header"><code>Cache-Control</code></a> (<code>Pragma</code> in <code>HTTP/1.0</code>)</li> <li><code>Expires</code></li> <li><code>ETag</code></li> <li><code>If-Match</code></li> <li><code>If-None-Match</code></li> <li><code>If-Range</code></li> <li><code>If-Modified-Since</code></li> <li><code>If-Unmodified-Since</code></li> <li><code>Last-Modified</code></li> <li><code>Vary</code></li></ul> <h4 id="age-header"><a href="#age-header" class="header-anchor">#</a> Age Header</h4> <p>Syntax:</p> <div class="language- extra-class"><pre class="language-text"><code>Age: &lt;seconds&gt;
</code></pre></div><p>Example:</p> <div class="language- extra-class"><pre class="language-text"><code>Age: 24
</code></pre></div><p>Type: Response Header</p> <p>值为seconds数，仅在响应中出现，表明该资源在缓存系统中存在的时间。如果<code>Age: 0</code>，则表明该资源刚刚从源服务器获取。</p> <p>任何包含缓存系统的<code>HTTP/1.1</code>服务器，缓存系统的响应必须(MUST)返回<code>Age</code> Header。</p> <p><code>Age</code>的值应该(SHOULD)至少为31 bits。如果值overflow了，则必须(MUST)返回<code>2147483648 (2^31)</code>。</p> <h4 id="cache-control-header"><a href="#cache-control-header" class="header-anchor">#</a> Cache-Control Header</h4> <p>Examples:</p> <div class="language- extra-class"><pre class="language-text"><code>Cache-Control: no-cache no-store must-revalidate
Cache-Control: max-age=3600 must-revalidate
</code></pre></div><p>Type: General Header</p> <p><code>Cache-Control</code>在<code>HTTP/1.1</code>中加入。在<code>HTTP/1.0</code>中不能使用<code>Cache-Control</code>，只能使用<code>Pragma: no-cache</code>。</p> <p><code>Cache-Control</code>下的指令在通过 proxy 和 gateway application 时必须被传递，因为在 request/response chain 中的任何部分都可能会被用到。</p> <p><code>Cache-Control</code>可能使用的指令(Directives)有：</p> <blockquote><p>注：<code>[...]</code>内代表可选参数</p></blockquote> <ul><li><strong>Cacheability</strong> <ul><li><code>public</code>: 表明该响应可以(MAY)被任何类型缓存。(response only)</li> <li><code>private[=&quot;&lt;field-name&gt;&quot;]</code>: 表明该响应是针对单个用户的，只能(MAY)被私有缓存，不能(MUST NOT)被共享缓存。(response only)</li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">PS</p> <p>可以通过<code>field-name</code>对个别缓存系统进行限定，但没太搞懂这里的<code>field-name</code>指的是什么。一般都不指定<code>field-name</code>，代表针对所有缓存系统。目前MDN的文档上就没写<code>field-name</code>。</p></div> <ul><li><p><strong>Expiration</strong></p> <ul><li><code>max-age=&lt;seconds&gt;</code>: 在请求中出现，表明客户端愿意接收的资源的最大age，如果没有<code>max-stale</code>一起出现，则拒绝接收过期资源。在响应中出现，表明设置该响应资源的最大过期时间。(request &amp; response)</li> <li><code>min-fresh=&lt;seconds&gt;</code>: 表明客户端希望接收到的资源的最低剩余新鲜度，即距离过期还剩的最少时间。(request only)</li> <li><code>max-stale[=&lt;seconds&gt;]</code>: 表明客户端愿意接收过期资源。如果限定了<code>&lt;seconds&gt;</code>，则表明愿意接收过期时间不超过<code>&lt;seconds&gt;</code>的资源。如果不限定，则表明愿意接收任何过期资源。</li> <li><code>s-maxage=&lt;seconds&gt;</code>: 只针对共享缓存，不针对私有缓存（被私有缓存忽略）。<code>s-maxage</code>将覆盖所有其他的<code>max-age</code>指令或<code>Expires</code> Header所设定的过期时间。(response only)</li></ul></li> <li><p><strong>Revalidation and reloading</strong></p> <ul><li><code>no-cache[=&quot;&lt;field-name&gt;&quot;]</code>: 不论缓存资源是否过期，强制缓存系统向服务器进行验证，避免从缓存系统中获取到过期资源（<strong>注意：不是说没有缓存，只是必须再次验证，避免获取到过期资源。如果验证结果是<code>304 Not Modified</code>则可以使用缓存副本</strong>）。如果在请求中出现<code>no-cache</code>，则不应该(SHOULD NOT)再出现<code>min-fresh</code>, <code>max-stale</code>或<code>max-age</code>。(request &amp; response)</li> <li><code>only-if-cached</code>: 在发送请求时加入，只请求已缓存的资源，避免向源服务器重载或验证。此时缓存服务器应当返回一个缓存副本，或者<code>504 Gateway Timeout</code>。如果配置了缓存集群，则可以将该请求分发到缓存集群中。(request only)</li> <li><code>must-revalidate</code>: 只能在响应中出现，表明该响应资源的缓存一旦过期，必须向源服务器发送重验证，而不能将过期资源提供给客户端。如果缓存系统不能访问到源服务器进行重验证，则返回<code>504 Gateway Timeout</code>，不能返回未验证的过期资源。一旦设置<code>must-revalidate</code>，则忽略客户端请求的<code>max-stale</code>，仅遵守源服务器提供的<code>max-age</code>或者<code>Expires</code>。(response only)</li> <li><code>proxy-revalidate</code>: 只能在响应中出现，与<code>must-revalidate</code>作用相同，但仅对非共享缓存/私有缓存有效。(response only)</li></ul></li> <li><p><strong>Other</strong></p> <ul><li><code>no-store</code>: 禁止缓存系统对资源进行任何存储，即禁止使用缓存。如果在请求中出现，则缓存系统不能(MUST NOT)存储该请求的任何部分，以及针对该请求的响应。如果在响应中出现，则缓存系统不能(MUST NOT)存储该响应的任何部分，以及引发该响应的请求。“不能(MUST NOT)存储”的意思是，缓存系统不能有意地将其存储到非易失性存储器中，且在分发完相关资源后，立即从易失性存储器中移除。主要是为了避免敏感信息的泄露，但恶意缓存服务器可以选择不遵守此规定，并且浏览器的历史记录Buffer是会正常存储相关资源的。(request &amp; response)</li> <li><code>no-transform</code>: 禁止缓存系统对资源进行转换，禁止缓存系统和代理服务器改变相关的Headers(<code>Content-Encoding</code>, <code>Content-Range</code>, <code>Content-Type</code>)。缓存系统常常会把某些媒体类型进行转换，用以节省缓存存储空间，或降低传输负载，而<code>no-transform</code> Header禁止进行任何转换。(request &amp; response)</li></ul></li></ul> <h5 id="请求和响应中的cache-control小结"><a href="#请求和响应中的cache-control小结" class="header-anchor">#</a> 请求和响应中的<code>Cache-Control</code>小结</h5> <ul><li><p>Cache Request Directives</p> <ul><li><code>no-store</code>: 缓存系统不能(MUST NOT)存储该请求的任何部分，以及针对该请求的响应。</li> <li><code>no-cache</code>: 无论资源是否过期，缓存系统必须向源服务器发送验证。</li> <li><code>no-transform</code>: 禁止缓存系统对资源进行转换。</li> <li><code>only-if-cached</code>: 只接收已缓存资源，避免向源服务器请求。</li> <li><code>max-age=&lt;seconds&gt;</code>: 表明客户端愿意接收的资源的最大age。如果没有<code>max-stale</code>一起出现，则拒绝接收过期资源。</li> <li><code>max-stale[=&lt;seconds&gt;]</code>: 表明客户端愿意接收过期资源。如果有参数，则资源的过期时间不能超过<code>&lt;seconds&gt;</code>。</li> <li><code>min-fresh=&lt;seconds&gt;</code>: 表明客户端愿意接收的资源至少还有多久过期。</li></ul></li> <li><p>Cache Response Directives</p> <ul><li><code>public</code>: 允许共享和私有缓存。</li> <li><code>private</code>: 仅允许私有缓存。</li> <li><code>no-store</code>: 缓存系统不能(MUST NOT)存储该响应的任何部分，以及引发该响应的请求。</li> <li><code>no-cache</code>: 无论资源是否过期，缓存系统必须向源服务器发送验证。</li> <li><code>no-transform</code>: 禁止缓存系统对资源进行转换。</li> <li><code>must-revalidate</code>: 表明该响应资源的缓存一旦过期，必须向源服务器发送重验证，而不能将过期资源提供给客户端，忽略请求的<code>max-stale</code>。</li> <li><code>proxy-revalidate</code>: 与<code>must-revalidate</code>作用相同，仅对共享缓存生效。</li> <li><code>max-age=&lt;seconds&gt;</code>: 设置该响应资源的最大过期时间。</li> <li><code>s-maxage=&lt;seconds&gt;</code>: 覆盖共享缓存中所有其他的过期时间指令。在私有缓存中被忽略。</li></ul></li></ul> <div class="custom-block warning"><p class="custom-block-title">一些需要注意的点</p> <ul><li>部分指令只能在response或request中出现，且两边都能出现的时候意义不完全相同。</li> <li><code>no-cache</code>意思是必须验证，不代表不缓存。<code>no-store</code>代表不缓存。</li> <li><code>no-cache</code>, <code>must-revalidate</code>, <code>max-age=0</code>的区别。<code>no-cache</code>和<code>max-age</code>既可以在请求也可以响应中，<code>must-revalidate</code>只能在响应中。<code>no-cache</code>不论资源是否过期都要验证，<code>must-revalidate</code>只有资源过期时必须验证，<code>max-age=0</code>代表资源始终是过期的（response），或者表明请求希望得到的资源最大<code>age</code>为0（request）。</li></ul></div> <h4 id="expires-header"><a href="#expires-header" class="header-anchor">#</a> Expires Header</h4> <p>Syntax:</p> <div class="language- extra-class"><pre class="language-text"><code>Expires: &lt;http-date&gt;
</code></pre></div><p>Example:</p> <div class="language- extra-class"><pre class="language-text"><code>Expires: Wed, 21 Oct 2015 07:28:00 GMT
</code></pre></div><p>Type: Response Header</p> <p>值为一个HTTP-date timestamp，仅在响应中出现，设置该资源的过期时间，超过该时间视为stale。</p> <p>如果值不是合法的HTTP-date timestamp，则视为该资源已经过期。</p> <p>如果<code>Cache-Control</code>中设置了<code>max-age</code>或<code>s-maxage</code>，该字段被忽略。</p> <h4 id="etag-header"><a href="#etag-header" class="header-anchor">#</a> Etag Header</h4> <p>Syntax:</p> <div class="language- extra-class"><pre class="language-text"><code>ETag: W/&quot;&lt;etag_value&gt;&quot;
ETag: &quot;&lt;etag_value&gt;&quot;
</code></pre></div><p>Examples:</p> <div class="language- extra-class"><pre class="language-text"><code>ETag: &quot;33a64df551425fcc55e4d42a148795d9f25f89d4&quot;
ETag: W/&quot;0815&quot;
</code></pre></div><p>Type: Response Header</p> <p>当前资源的Entity Tag，可以用于配合<code>If-Match</code>, <code>If-None-Match</code>, <code>Vary</code>来判断是不是同一资源。</p> <p><code>W/</code>表明使用Weak Validator。</p> <blockquote><p>Etags的生成方法没有在HTTP中指明，常用的方法包括对资源内容进行Hash，对last modification timestamp进行Hash，或者单纯设定一个修订版本号。</p></blockquote> <h4 id="if-match-header"><a href="#if-match-header" class="header-anchor">#</a> If-Match Header</h4> <p>Syntax:</p> <div class="language- extra-class"><pre class="language-text"><code>If-Match: &lt;etag_value&gt;
If-Match: &lt;etag_value&gt;, &lt;etag_value&gt;, …
</code></pre></div><p>Examples:</p> <div class="language- extra-class"><pre class="language-text"><code>If-Match: &quot;bfc13a64729c4290ef5b2c2730249c88ca92d82d&quot;
If-Match: W/&quot;67ab43&quot;, &quot;54ed21&quot;, &quot;7892dd&quot;
If-Match: *
</code></pre></div><p>Type: Request header</p> <p>值为entity-tag，仅在请求中出现。当所请求资源的entity-tag匹配时，该请求才生效。如果没有匹配资源，或者<code>If-Match: *</code>但没有资源存在时，服务器不(MUST NOT)执行该请求，(MUST)返回<code>412 Precondition Failed</code>。</p> <p>对于需要更新资源的请求(比如PUT)来说，只有当entity-tag匹配时才会更新资源。</p> <p>如果一个请求在不考虑<code>If-Match</code>的情况下，就会返回<code>2xx/412</code>之外的状态，则忽略<code>If-Match</code>。(应该指的是<code>If-Match</code>的优先级比较低)</p> <p>如果请求同时存在<code>If-Match + If-None-Match</code> 或者 <code>If-Match + If-Modified-Since</code>，RFC2616中没有明确规定。</p> <blockquote><p>The result of a request having both an If-Match header field and either an If-None-Match or an If-Modified-Since header fields is undefined by this specification.</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">PS</p> <p>在RFC2616中写明，服务器必须使用强验证来比较<code>If-Match</code>中的entity-tag：</p> <blockquote><p>A server MUST use the strong comparison function (see section 13.3.3) to compare the entity tags in If-Match.</p></blockquote> <p>在MDN文档中，则说明如果加了<code>W/</code>前缀，则可以使用弱验证:</p> <blockquote><p>The comparison with the stored ETag uses the strong comparison algorithm, meaning two files are considered identical byte to byte only. This is weakened when the  W/ prefix is used in front of the ETag.</p></blockquote> <p>可能后者是Mozilla的implementation，在RFC2616的examples里面没有加<code>W/</code>前缀的例子，上面的examples是用的MDN上的。</p> <p>在缓存方面其实一般都是用<code>If-None-Match</code>。但是<code>If-Match</code>功能比较接近，所以也一并列出来了。</p></div> <h4 id="if-none-match-header"><a href="#if-none-match-header" class="header-anchor">#</a> If-None-Match Header</h4> <p>Syntax:</p> <div class="language- extra-class"><pre class="language-text"><code>If-None-Match: &lt;etag_value&gt;
If-None-Match: &lt;etag_value&gt;, &lt;etag_value&gt;, …
</code></pre></div><p>Examples:</p> <div class="language- extra-class"><pre class="language-text"><code>If-None-Match: &quot;bfc13a64729c4290ef5b2c2730249c88ca92d82d&quot;
If-None-Match: W/&quot;67ab43&quot;, &quot;54ed21&quot;, &quot;7892dd&quot;
If-None-Match: *
</code></pre></div><p>Type: Request header</p> <p>值为entity-tag，仅在请求中出现。当所请求资源的entity-tag没有匹配时，该请求才生效。如果存在匹配资源，或者<code>If-None-Match: *</code>且有资源存在时，服务器不(MUST NOT)执行该请求，且对于GET和HEAD请求应该(SHOULD)返回<code>304 Not Modified</code>并添加相应的缓存相关headers(特别是要添加<code>ETag</code>)，而对于其他请求方法(MUST)返回<code>412 Precondition Failed</code>。</p> <p>对于需要更新资源的请求(比如PUT)来说，只有相应资源不存在时才会生效，可以用来避免客户端对已存在的资源进行更新。</p> <p>如果一个请求的<code>If-None-Match</code>没有匹配到资源，则服务器必须(MUST)忽略该请求中的<code>If-Modified-Since</code>。也就是说，只要没有entity-tag匹配到，不管<code>If-Modified-Since</code>的结果如何，服务器就不能(MUST NOT)返回<code>304 Not Modified</code>。</p> <p>如果一个请求在不考虑<code>If-None-Match</code>的情况下，就会返回<code>2xx/304</code>(应该还包括<code>412</code>，但是RFC2616上没写明)之外的状态，则忽略<code>If-None-Match</code>。(同样应该指的是<code>If-None-Match</code>的优先级比较低)</p> <div class="custom-block tip"><p class="custom-block-title">PS</p> <p>在RFC2616中写明，服务器只能对GET和HEAD请求使用弱验证来比较<code>If-None-Match</code>中的entity-tag：</p> <blockquote><p>The weak comparison function can only be used with GET or HEAD requests.</p></blockquote> <p>在MDN文档中，则只说明使用弱验证:</p> <blockquote><p>The comparison with the stored ETag uses the weak comparison algorithm.</p></blockquote></div> <h4 id="if-modified-since-header"><a href="#if-modified-since-header" class="header-anchor">#</a> If-Modified-Since Header</h4> <p>Syntax:</p> <div class="language- extra-class"><pre class="language-text"><code>If-Modified-Since: &lt;day-name&gt;, &lt;day&gt; &lt;month&gt; &lt;year&gt; &lt;hour&gt;:&lt;minute&gt;:&lt;second&gt; GMT
</code></pre></div><p>Examples:</p> <div class="language- extra-class"><pre class="language-text"><code>If-Modified-Since: Wed, 21 Oct 2015 07:28:00 GMT
</code></pre></div><p>Type: Request header</p> <p>仅在请求中出现，且只能在GET或HEAD中使用。如果请求的资源在给定时间后被修改，则像普通GET请求一样返回<code>200</code>。如果没有被修改，则返回<code>304 Not Modified</code>。</p> <p>在和<code>If-None-Match</code>一起出现时，将被忽略。</p> <h4 id="if-unmodified-since-header"><a href="#if-unmodified-since-header" class="header-anchor">#</a> If-Unmodified-Since Header</h4> <p>Syntax:</p> <div class="language- extra-class"><pre class="language-text"><code>If-Unmodified-Since: &lt;day-name&gt;, &lt;day&gt; &lt;month&gt; &lt;year&gt; &lt;hour&gt;:&lt;minute&gt;:&lt;second&gt; GMT
</code></pre></div><p>Examples:</p> <div class="language- extra-class"><pre class="language-text"><code>If-Unmodified-Since: Wed, 21 Oct 2015 07:28:00 GMT
</code></pre></div><p>Type: Request header</p> <p>仅在请求中出现。如果请求的资源在给定时间没有被修改，则服务器应该(SHOULD)当作没有<code>If-Unmodified-Since</code>存在一样处理该请求。如果在给定时间后有被修改，则服务器不(MUST NOT)处理该请求，并返回<code>412 Precondition Failed</code>。</p> <p>如果一个请求在不考虑<code>If-Unmodified-Since</code>的情况下，就会返回<code>2xx/412</code>之外的状态，则忽略<code>If-Unmodified-Since</code>。</p> <div class="custom-block tip"><p class="custom-block-title">PS</p> <p>在缓存方面其实一般都是用<code>If-Modified-Since</code>。但是<code>If-Unmodified-Since</code>功能比较接近，所以也一并列出来了。</p></div> <h4 id="last-modified-header"><a href="#last-modified-header" class="header-anchor">#</a> Last-Modified Header</h4> <p>Syntax:</p> <div class="language- extra-class"><pre class="language-text"><code>Last-Modified: &lt;day-name&gt;, &lt;day&gt; &lt;month&gt; &lt;year&gt; &lt;hour&gt;:&lt;minute&gt;:&lt;second&gt; GMT
</code></pre></div><p>Example:</p> <div class="language- extra-class"><pre class="language-text"><code>Last-Modified: Wed, 21 Oct 2015 07:28:00 GMT
</code></pre></div><p>Type: Response Header</p> <p>仅在响应中出现，表明源服务器上该资源的最后修改时间。可以用来验证资源是否是相同的，精确性比<code>ETag</code>低，大部分情况下仅作为备用机制。</p> <p>对于该值的准确意义，与源服务器的实现方式和资源的类型有关。对于文件资源，可以是filesystem的last-modified time；对于数据库gateway，可以是记录的last-update timestamp等等。</p> <p>源服务器不能(MUST NOT)把<code>Last-Modified</code>的值设置为比消息源(message origination，我理解为请求的时间)更晚的时间。如果得到的时间确实超过消息源时间，则必须(MUST)将<code>Last-Modified</code>设置为与消息源一样的时间。</p> <p><code>HTTP/1.1</code>应该(SHOULD)在任何可行的情况下，尽可能发送<code>Last-Modified</code> Header。</p> <h4 id="vary-header"><a href="#vary-header" class="header-anchor">#</a> Vary Header</h4> <p>Syntax:</p> <div class="language- extra-class"><pre class="language-text"><code>Vary: *
Vary: &lt;header-name&gt;, &lt;header-name&gt;, ...
</code></pre></div><p>Example:</p> <div class="language- extra-class"><pre class="language-text"><code>Vary: User-Agent
</code></pre></div><p>Type: Response Header</p> <p>仅在响应中出现，表明在后续的请求中，要根据设置的Header来判断是否能使用该资源的缓存。</p> <p>如果设置<code>Vary: *</code>，表明缓存系统无法通过Header来判断是否可以返回该资源，相当于每个不同的请求都不能使用该资源的缓存。</p> <p><code>HTTP/1.1</code>服务器对在所有可缓存的响应中都应该(SHOULD)包含<code>Vary</code> Header。</p> <blockquote><p>大部分常见的会用到<code>Accept-Encoding</code></p></blockquote> <h3 id="expiration-model-todo"><a href="#expiration-model-todo" class="header-anchor">#</a> Expiration Model [TODO]</h3> <ul><li>客户端发起请求，检查缓存是否命中：
<ul><li>若请求没有在缓存中命中，则直接向服务器转发请求，然后缓存响应资源。</li> <li>若请求在缓存中命中，检查缓存是否fresh：
<ul><li>若fresh，则直接返回缓存资源，状态码<code>200</code></li> <li>若stale，则通过在请求中添加<code>If-None-Match</code>向服务器请求检查资源是否fresh：
<ul><li>若返回<code>304 Not Modified</code>，则缓存重置资源<code>Age</code>，并将缓存资源返回给客户端</li> <li>若返回<code>200</code>，则缓存新的资源，并返回给客户端</li></ul></li></ul></li></ul></li></ul> <p>资源“保鲜”时长：</p> <div class="language- extra-class"><pre class="language-text"><code>freshness_lifetime = `max-age` || (`Expires` - `Date`) || ((`Date` - `Last-Modified`) * 10%)
</code></pre></div><p>资源过期时间：</p> <div class="language- extra-class"><pre class="language-text"><code>expiration_time = response_time + freshness_lifetime - current_age
</code></pre></div><p><code>response_time</code>表示客户端接收到此响应的时间点。</p> <h3 id="validation-model-todo"><a href="#validation-model-todo" class="header-anchor">#</a> Validation Model [TODO]</h3> <h4 id="last-modified-etag"><a href="#last-modified-etag" class="header-anchor">#</a> Last-Modified / Etag</h4> <h4 id="weak-and-strong-validators"><a href="#weak-and-strong-validators" class="header-anchor">#</a> Weak and Strong Validators</h4> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching" target="_blank" rel="noopener noreferrer">HTTP caching | MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control" target="_blank" rel="noopener noreferrer">Cache-Control | MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html" target="_blank" rel="noopener noreferrer">HTTP/1.1: Caching in HTTP - RFC2616<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html" target="_blank" rel="noopener noreferrer">HTTP/1.1: Header Field Definitions - RFC2616<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://en.wikipedia.org/wiki/HTTP_ETag" target="_blank" rel="noopener noreferrer">HTTP ETag - WikiPedia<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/chyingp/p/no-cache-vs-must-revalidate.html" target="_blank" rel="noopener noreferrer">web性能优化之：no-cache与must-revalidate深入探究<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="写在后面"><a href="#写在后面" class="header-anchor">#</a> 写在后面</h2> <p>研二快结束了，这一两个月在找暑期实习。</p> <p>在面腾讯SNG前端的时候，对缓存这部分好像挺重视的。但是当时还没怎么好好看过这部分内容，基本没答上什么，二面面试官就让我趁这两个月回去好好看看。（听这话的意思好像是在说我已经稳了，但是没想到HR面之后已经过了一个月，还是没有任何消息……好慌😅）</p> <p>实习的事先不论，想好好做前端的话，这些该补的还是要补上。</p> <p>----update20180601</p> <p>拿到腾讯SNG的前端实习offer啦，下个月去深圳实习~</p></div></article> <section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2018-05-12
    </span> <!----></section> <section class="post-links" data-v-4e23451f><a href="/posts/2018/05/09/hello-world.html" class="post-link" data-v-4e23451f>
      上一篇 : Hello, World!
    </a> <a href="/posts/2018/06/06/internship-of-2018.html" class="post-link" data-v-4e23451f>
      下一篇 : 2018年互联网公司暑期实习笔试面试经历
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-6e91a59a><div class="info-card main-div" data-v-23d90c50 data-v-6e91a59a><div class="info-card-header" data-v-23d90c50><img src="/assets/img/avatar.jpg" alt="meteorlxy" class="info-avatar" data-v-23d90c50></div> <div class="info-card-body" data-v-23d90c50><section class="info-nickname" data-v-23d90c50>
      meteorlxy
    </section> <section class="info-desc" data-v-23d90c50>Happy Coding<br/>Happy Life</section> <section class="info-contact" data-v-23d90c50><section data-v-23d90c50><span title="Shenzhen, China" data-v-23d90c50 data-v-23d90c50><svg class="icon" style="font-size:1em;" data-v-23d90c50 data-v-23d90c50><title data-v-23d90c50 data-v-23d90c50>Shenzhen, China</title><use xlink:href="#icon-location" data-v-23d90c50 data-v-23d90c50></use></svg><span class="info-text" data-v-23d90c50 data-v-23d90c50>
          Shenzhen, China
        </span></span></section> <section data-v-23d90c50><span title="Tencent" data-v-23d90c50 data-v-23d90c50><svg class="icon" style="font-size:1em;" data-v-23d90c50 data-v-23d90c50><title data-v-23d90c50 data-v-23d90c50>Tencent</title><use xlink:href="#icon-organization" data-v-23d90c50 data-v-23d90c50></use></svg><span class="info-text" data-v-23d90c50 data-v-23d90c50>
          Tencent
        </span></span></section> <section data-v-23d90c50><a href="mailto:meteor.lxy@foxmail.com" title="meteor.lxy@foxmail.com" data-v-23d90c50 data-v-23d90c50><svg class="icon" style="font-size:1em;" data-v-23d90c50 data-v-23d90c50><title data-v-23d90c50 data-v-23d90c50>meteor.lxy@foxmail.com</title><use xlink:href="#icon-email" data-v-23d90c50 data-v-23d90c50></use></svg><span class="info-text" data-v-23d90c50 data-v-23d90c50>
          meteor.lxy@foxmail.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-23d90c50><section class="info-sns clearfix" data-v-23d90c50><a href="https://github.com/meteorlxy" target="_blank" class="sns-link" data-v-23d90c50><span title="GitHub: meteorlxy" class="sns-icon" data-v-23d90c50 data-v-23d90c50><svg class="icon" style="font-size:1.5em;" data-v-23d90c50 data-v-23d90c50><title data-v-23d90c50 data-v-23d90c50>GitHub: meteorlxy</title><use xlink:href="#icon-github" data-v-23d90c50 data-v-23d90c50></use></svg></span></a><a href="https://www.facebook.com/meteorlxy.cn" target="_blank" class="sns-link" data-v-23d90c50><span title="Facebook: meteorlxy.cn" class="sns-icon" data-v-23d90c50 data-v-23d90c50><svg class="icon" style="font-size:1.5em;" data-v-23d90c50 data-v-23d90c50><title data-v-23d90c50 data-v-23d90c50>Facebook: meteorlxy.cn</title><use xlink:href="#icon-facebook" data-v-23d90c50 data-v-23d90c50></use></svg></span></a><a href="http://www.linkedin.com/in/meteorlxy" target="_blank" class="sns-link" data-v-23d90c50><span title="LinkedIn: meteorlxy" class="sns-icon" data-v-23d90c50 data-v-23d90c50><svg class="icon" style="font-size:1.5em;" data-v-23d90c50 data-v-23d90c50><title data-v-23d90c50 data-v-23d90c50>LinkedIn: meteorlxy</title><use xlink:href="#icon-linkedin" data-v-23d90c50 data-v-23d90c50></use></svg></span></a><a href="https://twitter.com/meteorlxy_cn" target="_blank" class="sns-link" data-v-23d90c50><span title="Twitter: meteorlxy_cn" class="sns-icon" data-v-23d90c50 data-v-23d90c50><svg class="icon" style="font-size:1.5em;" data-v-23d90c50 data-v-23d90c50><title data-v-23d90c50 data-v-23d90c50>Twitter: meteorlxy_cn</title><use xlink:href="#icon-twitter" data-v-23d90c50 data-v-23d90c50></use></svg></span></a><a href="https://weibo.com/u/2039655434" target="_blank" class="sns-link" data-v-23d90c50><span title="新浪微博: @焦炭君_Meteor" class="sns-icon" data-v-23d90c50 data-v-23d90c50><svg class="icon" style="font-size:1.5em;" data-v-23d90c50 data-v-23d90c50><title data-v-23d90c50 data-v-23d90c50>新浪微博: @焦炭君_Meteor</title><use xlink:href="#icon-weibo" data-v-23d90c50 data-v-23d90c50></use></svg></span></a><a href="https://www.zhihu.com/people/meteorlxy.cn" target="_blank" class="sns-link" data-v-23d90c50><span title="知乎: meteorlxy.cn" class="sns-icon" data-v-23d90c50 data-v-23d90c50><svg class="icon" style="font-size:1.5em;" data-v-23d90c50 data-v-23d90c50><title data-v-23d90c50 data-v-23d90c50>知乎: meteorlxy.cn</title><use xlink:href="#icon-zhihu" data-v-23d90c50 data-v-23d90c50></use></svg></span></a><a href="https://www.douban.com/people/159342708" target="_blank" class="sns-link" data-v-23d90c50><span title="豆瓣: 159342708" class="sns-icon" data-v-23d90c50 data-v-23d90c50><svg class="icon" style="font-size:1.5em;" data-v-23d90c50 data-v-23d90c50><title data-v-23d90c50 data-v-23d90c50>豆瓣: 159342708</title><use xlink:href="#icon-douban" data-v-23d90c50 data-v-23d90c50></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-6e91a59a><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>文章目录</span> <div class="post-nav-toc"><ul><li><a href="/posts/2018/05/12/http-caching.html#可能进行缓存的内容">可能进行缓存的内容</a></li><li><a href="/posts/2018/05/12/http-caching.html#缓存类型">缓存类型</a></li><li><a href="/posts/2018/05/12/http-caching.html#缓存控制">缓存控制</a><ul><li><a href="/posts/2018/05/12/http-caching.html#related-http-headers">Related HTTP Headers</a></li><li><a href="/posts/2018/05/12/http-caching.html#expiration-model-todo">Expiration Model [TODO]</a></li><li><a href="/posts/2018/05/12/http-caching.html#validation-model-todo">Validation Model [TODO]</a></li></ul></li><li><a href="/posts/2018/05/12/http-caching.html#references">References</a></li><li><a href="/posts/2018/05/12/http-caching.html#写在后面">写在后面</a></li></ul></div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/posts/2018/05/12/http-caching.html#post-comments">
      评论
    </a></div></div></aside></div> <footer class="footer" data-v-f018ab8c><p class="footer-sns-links" data-v-f018ab8c><a href="https://github.com/meteorlxy" target="_blank" class="sns-link" data-v-f018ab8c><span title="GitHub: meteorlxy" class="sns-icon" data-v-f018ab8c data-v-f018ab8c><svg class="icon" style="font-size:25px;" data-v-f018ab8c data-v-f018ab8c><title data-v-f018ab8c data-v-f018ab8c>GitHub: meteorlxy</title><use xlink:href="#icon-github" data-v-f018ab8c data-v-f018ab8c></use></svg></span></a><a href="https://www.facebook.com/meteorlxy.cn" target="_blank" class="sns-link" data-v-f018ab8c><span title="Facebook: meteorlxy.cn" class="sns-icon" data-v-f018ab8c data-v-f018ab8c><svg class="icon" style="font-size:25px;" data-v-f018ab8c data-v-f018ab8c><title data-v-f018ab8c data-v-f018ab8c>Facebook: meteorlxy.cn</title><use xlink:href="#icon-facebook" data-v-f018ab8c data-v-f018ab8c></use></svg></span></a><a href="http://www.linkedin.com/in/meteorlxy" target="_blank" class="sns-link" data-v-f018ab8c><span title="LinkedIn: meteorlxy" class="sns-icon" data-v-f018ab8c data-v-f018ab8c><svg class="icon" style="font-size:25px;" data-v-f018ab8c data-v-f018ab8c><title data-v-f018ab8c data-v-f018ab8c>LinkedIn: meteorlxy</title><use xlink:href="#icon-linkedin" data-v-f018ab8c data-v-f018ab8c></use></svg></span></a><a href="https://twitter.com/meteorlxy_cn" target="_blank" class="sns-link" data-v-f018ab8c><span title="Twitter: meteorlxy_cn" class="sns-icon" data-v-f018ab8c data-v-f018ab8c><svg class="icon" style="font-size:25px;" data-v-f018ab8c data-v-f018ab8c><title data-v-f018ab8c data-v-f018ab8c>Twitter: meteorlxy_cn</title><use xlink:href="#icon-twitter" data-v-f018ab8c data-v-f018ab8c></use></svg></span></a><a href="https://weibo.com/u/2039655434" target="_blank" class="sns-link" data-v-f018ab8c><span title="新浪微博: @焦炭君_Meteor" class="sns-icon" data-v-f018ab8c data-v-f018ab8c><svg class="icon" style="font-size:25px;" data-v-f018ab8c data-v-f018ab8c><title data-v-f018ab8c data-v-f018ab8c>新浪微博: @焦炭君_Meteor</title><use xlink:href="#icon-weibo" data-v-f018ab8c data-v-f018ab8c></use></svg></span></a><a href="https://www.zhihu.com/people/meteorlxy.cn" target="_blank" class="sns-link" data-v-f018ab8c><span title="知乎: meteorlxy.cn" class="sns-icon" data-v-f018ab8c data-v-f018ab8c><svg class="icon" style="font-size:25px;" data-v-f018ab8c data-v-f018ab8c><title data-v-f018ab8c data-v-f018ab8c>知乎: meteorlxy.cn</title><use xlink:href="#icon-zhihu" data-v-f018ab8c data-v-f018ab8c></use></svg></span></a><a href="https://www.douban.com/people/159342708" target="_blank" class="sns-link" data-v-f018ab8c><span title="豆瓣: 159342708" class="sns-icon" data-v-f018ab8c data-v-f018ab8c><svg class="icon" style="font-size:25px;" data-v-f018ab8c data-v-f018ab8c><title data-v-f018ab8c data-v-f018ab8c>豆瓣: 159342708</title><use xlink:href="#icon-douban" data-v-f018ab8c data-v-f018ab8c></use></svg></span></a></p> <p class="footer-text" data-v-f018ab8c><span data-v-f018ab8c>Powered by </span> <a href="https://github.com/vuejs/vuepress" target="_blank" data-v-f018ab8c>
      VuePress
    </a> <span data-v-f018ab8c> | </span> <a href="https://github.com/meteorlxy/vuepress-theme-meteorlxy" target="_blank" data-v-f018ab8c>
        meteorlxy
      </a></p> <!----></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/vendor.2.1dac5719.js" defer></script><script src="/assets/js/6.203a490e.js" defer></script><script src="/assets/js/vendor.1.27c1b491.js" defer></script><script src="/assets/js/vendor.0.85f8c959.js" defer></script><script src="/assets/js/app.d3b3b19c.js" defer></script>
  </body>
</html>
