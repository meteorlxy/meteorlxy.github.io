(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{282:function(e,a,t){"use strict";t.r(a);var v=t(0),_=Object(v.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("缓存对于前端性能优化等方面都有着重要意义。这篇把HTTP缓存相关的知识点总在这里，部分内容自己重新描述了一下，加深理解。")]),e._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[e._v("TODOS")]),e._v(" "),t("ul",[t("li",[e._v("RFC2616 Capter 13: Caching in HTTP")])])]),e._v(" "),t("h1",{attrs:{id:"http-caching-http-缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http-caching-http-缓存"}},[e._v("#")]),e._v(" HTTP Caching - HTTP 缓存")]),e._v(" "),t("TOC"),e._v(" "),t("h2",{attrs:{id:"可能进行缓存的内容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#可能进行缓存的内容"}},[e._v("#")]),e._v(" 可能进行缓存的内容")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("GET")]),e._v("请求的"),t("code",[e._v("200 OK")]),e._v("响应，可能是HTML文档、图片、文件等资源。")]),e._v(" "),t("li",[t("code",[e._v("301 Moved Permanently")])]),e._v(" "),t("li",[t("code",[e._v("404 Not Found")])]),e._v(" "),t("li",[t("code",[e._v("206 Partial Content")])]),e._v(" "),t("li",[t("code",[e._v("GET")]),e._v("请求以外的、定义了"),t("code",[e._v("cache key")]),e._v("的内容")])]),e._v(" "),t("h2",{attrs:{id:"缓存类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存类型"}},[e._v("#")]),e._v(" 缓存类型")]),e._v(" "),t("ul",[t("li",[e._v("私有 "),t("code",[e._v("private")]),e._v("：只能被特定用户使用，比如浏览器缓存")]),e._v(" "),t("li",[e._v("公有/共享 "),t("code",[e._v("public")]),e._v("/"),t("code",[e._v("shared")]),e._v("：可以被多个用户使用，比如代理缓存、CDN缓存等")])]),e._v(" "),t("h2",{attrs:{id:"缓存控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存控制"}},[e._v("#")]),e._v(" 缓存控制")]),e._v(" "),t("h3",{attrs:{id:"related-http-headers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#related-http-headers"}},[e._v("#")]),e._v(" Related HTTP Headers")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("Age")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#cache-control-header"}},[t("code",[e._v("Cache-Control")])]),e._v(" ("),t("code",[e._v("Pragma")]),e._v(" in "),t("code",[e._v("HTTP/1.0")]),e._v(")")]),e._v(" "),t("li",[t("code",[e._v("Expires")])]),e._v(" "),t("li",[t("code",[e._v("ETag")])]),e._v(" "),t("li",[t("code",[e._v("If-Match")])]),e._v(" "),t("li",[t("code",[e._v("If-None-Match")])]),e._v(" "),t("li",[t("code",[e._v("If-Range")])]),e._v(" "),t("li",[t("code",[e._v("If-Modified-Since")])]),e._v(" "),t("li",[t("code",[e._v("If-Unmodified-Since")])]),e._v(" "),t("li",[t("code",[e._v("Last-Modified")])]),e._v(" "),t("li",[t("code",[e._v("Vary")])])]),e._v(" "),t("h4",{attrs:{id:"age-header"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#age-header"}},[e._v("#")]),e._v(" Age Header")]),e._v(" "),t("p",[e._v("Syntax:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Age: <seconds>\n")])])]),t("p",[e._v("Example:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Age: 24\n")])])]),t("p",[e._v("Type: Response Header")]),e._v(" "),t("p",[e._v("值为seconds数，仅在响应中出现，表明该资源在缓存系统中存在的时间。如果"),t("code",[e._v("Age: 0")]),e._v("，则表明该资源刚刚从源服务器获取。")]),e._v(" "),t("p",[e._v("任何包含缓存系统的"),t("code",[e._v("HTTP/1.1")]),e._v("服务器，缓存系统的响应必须(MUST)返回"),t("code",[e._v("Age")]),e._v(" Header。")]),e._v(" "),t("p",[t("code",[e._v("Age")]),e._v("的值应该(SHOULD)至少为31 bits。如果值overflow了，则必须(MUST)返回"),t("code",[e._v("2147483648 (2^31)")]),e._v("。")]),e._v(" "),t("h4",{attrs:{id:"cache-control-header"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cache-control-header"}},[e._v("#")]),e._v(" Cache-Control Header")]),e._v(" "),t("p",[e._v("Examples:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Cache-Control: no-cache no-store must-revalidate\nCache-Control: max-age=3600 must-revalidate\n")])])]),t("p",[e._v("Type: General Header")]),e._v(" "),t("p",[t("code",[e._v("Cache-Control")]),e._v("在"),t("code",[e._v("HTTP/1.1")]),e._v("中加入。在"),t("code",[e._v("HTTP/1.0")]),e._v("中不能使用"),t("code",[e._v("Cache-Control")]),e._v("，只能使用"),t("code",[e._v("Pragma: no-cache")]),e._v("。")]),e._v(" "),t("p",[t("code",[e._v("Cache-Control")]),e._v("下的指令在通过 proxy 和 gateway application 时必须被传递，因为在 request/response chain 中的任何部分都可能会被用到。")]),e._v(" "),t("p",[t("code",[e._v("Cache-Control")]),e._v("可能使用的指令(Directives)有：")]),e._v(" "),t("blockquote",[t("p",[e._v("注："),t("code",[e._v("[...]")]),e._v("内代表可选参数")])]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Cacheability")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("public")]),e._v(": 表明该响应可以(MAY)被任何类型缓存。(response only)")]),e._v(" "),t("li",[t("code",[e._v('private[="<field-name>"]')]),e._v(": 表明该响应是针对单个用户的，只能(MAY)被私有缓存，不能(MUST NOT)被共享缓存。(response only)")])])])]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("PS")]),e._v(" "),t("p",[e._v("可以通过"),t("code",[e._v("field-name")]),e._v("对个别缓存系统进行限定，但没太搞懂这里的"),t("code",[e._v("field-name")]),e._v("指的是什么。一般都不指定"),t("code",[e._v("field-name")]),e._v("，代表针对所有缓存系统。目前MDN的文档上就没写"),t("code",[e._v("field-name")]),e._v("。")])]),e._v(" "),t("ul",[t("li",[t("p",[t("strong",[e._v("Expiration")])]),e._v(" "),t("ul",[t("li",[t("code",[e._v("max-age=<seconds>")]),e._v(": 在请求中出现，表明客户端愿意接收的资源的最大age，如果没有"),t("code",[e._v("max-stale")]),e._v("一起出现，则拒绝接收过期资源。在响应中出现，表明设置该响应资源的最大过期时间。(request & response)")]),e._v(" "),t("li",[t("code",[e._v("min-fresh=<seconds>")]),e._v(": 表明客户端希望接收到的资源的最低剩余新鲜度，即距离过期还剩的最少时间。(request only)")]),e._v(" "),t("li",[t("code",[e._v("max-stale[=<seconds>]")]),e._v(": 表明客户端愿意接收过期资源。如果限定了"),t("code",[e._v("<seconds>")]),e._v("，则表明愿意接收过期时间不超过"),t("code",[e._v("<seconds>")]),e._v("的资源。如果不限定，则表明愿意接收任何过期资源。")]),e._v(" "),t("li",[t("code",[e._v("s-maxage=<seconds>")]),e._v(": 只针对共享缓存，不针对私有缓存（被私有缓存忽略）。"),t("code",[e._v("s-maxage")]),e._v("将覆盖所有其他的"),t("code",[e._v("max-age")]),e._v("指令或"),t("code",[e._v("Expires")]),e._v(" Header所设定的过期时间。(response only)")])])]),e._v(" "),t("li",[t("p",[t("strong",[e._v("Revalidation and reloading")])]),e._v(" "),t("ul",[t("li",[t("code",[e._v('no-cache[="<field-name>"]')]),e._v(": 不论缓存资源是否过期，强制缓存系统向服务器进行验证，避免从缓存系统中获取到过期资源（"),t("strong",[e._v("注意：不是说没有缓存，只是必须再次验证，避免获取到过期资源。如果验证结果是"),t("code",[e._v("304 Not Modified")]),e._v("则可以使用缓存副本")]),e._v("）。如果在请求中出现"),t("code",[e._v("no-cache")]),e._v("，则不应该(SHOULD NOT)再出现"),t("code",[e._v("min-fresh")]),e._v(", "),t("code",[e._v("max-stale")]),e._v("或"),t("code",[e._v("max-age")]),e._v("。(request & response)")]),e._v(" "),t("li",[t("code",[e._v("only-if-cached")]),e._v(": 在发送请求时加入，只请求已缓存的资源，避免向源服务器重载或验证。此时缓存服务器应当返回一个缓存副本，或者"),t("code",[e._v("504 Gateway Timeout")]),e._v("。如果配置了缓存集群，则可以将该请求分发到缓存集群中。(request only)")]),e._v(" "),t("li",[t("code",[e._v("must-revalidate")]),e._v(": 只能在响应中出现，表明该响应资源的缓存一旦过期，必须向源服务器发送重验证，而不能将过期资源提供给客户端。如果缓存系统不能访问到源服务器进行重验证，则返回"),t("code",[e._v("504 Gateway Timeout")]),e._v("，不能返回未验证的过期资源。一旦设置"),t("code",[e._v("must-revalidate")]),e._v("，则忽略客户端请求的"),t("code",[e._v("max-stale")]),e._v("，仅遵守源服务器提供的"),t("code",[e._v("max-age")]),e._v("或者"),t("code",[e._v("Expires")]),e._v("。(response only)")]),e._v(" "),t("li",[t("code",[e._v("proxy-revalidate")]),e._v(": 只能在响应中出现，与"),t("code",[e._v("must-revalidate")]),e._v("作用相同，但仅对非共享缓存/私有缓存有效。(response only)")])])]),e._v(" "),t("li",[t("p",[t("strong",[e._v("Other")])]),e._v(" "),t("ul",[t("li",[t("code",[e._v("no-store")]),e._v(": 禁止缓存系统对资源进行任何存储，即禁止使用缓存。如果在请求中出现，则缓存系统不能(MUST NOT)存储该请求的任何部分，以及针对该请求的响应。如果在响应中出现，则缓存系统不能(MUST NOT)存储该响应的任何部分，以及引发该响应的请求。“不能(MUST NOT)存储”的意思是，缓存系统不能有意地将其存储到非易失性存储器中，且在分发完相关资源后，立即从易失性存储器中移除。主要是为了避免敏感信息的泄露，但恶意缓存服务器可以选择不遵守此规定，并且浏览器的历史记录Buffer是会正常存储相关资源的。(request & response)")]),e._v(" "),t("li",[t("code",[e._v("no-transform")]),e._v(": 禁止缓存系统对资源进行转换，禁止缓存系统和代理服务器改变相关的Headers("),t("code",[e._v("Content-Encoding")]),e._v(", "),t("code",[e._v("Content-Range")]),e._v(", "),t("code",[e._v("Content-Type")]),e._v(")。缓存系统常常会把某些媒体类型进行转换，用以节省缓存存储空间，或降低传输负载，而"),t("code",[e._v("no-transform")]),e._v(" Header禁止进行任何转换。(request & response)")])])])]),e._v(" "),t("h5",{attrs:{id:"请求和响应中的cache-control小结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#请求和响应中的cache-control小结"}},[e._v("#")]),e._v(" 请求和响应中的"),t("code",[e._v("Cache-Control")]),e._v("小结")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("Cache Request Directives")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("no-store")]),e._v(": 缓存系统不能(MUST NOT)存储该请求的任何部分，以及针对该请求的响应。")]),e._v(" "),t("li",[t("code",[e._v("no-cache")]),e._v(": 无论资源是否过期，缓存系统必须向源服务器发送验证。")]),e._v(" "),t("li",[t("code",[e._v("no-transform")]),e._v(": 禁止缓存系统对资源进行转换。")]),e._v(" "),t("li",[t("code",[e._v("only-if-cached")]),e._v(": 只接收已缓存资源，避免向源服务器请求。")]),e._v(" "),t("li",[t("code",[e._v("max-age=<seconds>")]),e._v(": 表明客户端愿意接收的资源的最大age。如果没有"),t("code",[e._v("max-stale")]),e._v("一起出现，则拒绝接收过期资源。")]),e._v(" "),t("li",[t("code",[e._v("max-stale[=<seconds>]")]),e._v(": 表明客户端愿意接收过期资源。如果有参数，则资源的过期时间不能超过"),t("code",[e._v("<seconds>")]),e._v("。")]),e._v(" "),t("li",[t("code",[e._v("min-fresh=<seconds>")]),e._v(": 表明客户端愿意接收的资源至少还有多久过期。")])])]),e._v(" "),t("li",[t("p",[e._v("Cache Response Directives")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("public")]),e._v(": 允许共享和私有缓存。")]),e._v(" "),t("li",[t("code",[e._v("private")]),e._v(": 仅允许私有缓存。")]),e._v(" "),t("li",[t("code",[e._v("no-store")]),e._v(": 缓存系统不能(MUST NOT)存储该响应的任何部分，以及引发该响应的请求。")]),e._v(" "),t("li",[t("code",[e._v("no-cache")]),e._v(": 无论资源是否过期，缓存系统必须向源服务器发送验证。")]),e._v(" "),t("li",[t("code",[e._v("no-transform")]),e._v(": 禁止缓存系统对资源进行转换。")]),e._v(" "),t("li",[t("code",[e._v("must-revalidate")]),e._v(": 表明该响应资源的缓存一旦过期，必须向源服务器发送重验证，而不能将过期资源提供给客户端，忽略请求的"),t("code",[e._v("max-stale")]),e._v("。")]),e._v(" "),t("li",[t("code",[e._v("proxy-revalidate")]),e._v(": 与"),t("code",[e._v("must-revalidate")]),e._v("作用相同，仅对共享缓存生效。")]),e._v(" "),t("li",[t("code",[e._v("max-age=<seconds>")]),e._v(": 设置该响应资源的最大过期时间。")]),e._v(" "),t("li",[t("code",[e._v("s-maxage=<seconds>")]),e._v(": 覆盖共享缓存中所有其他的过期时间指令。在私有缓存中被忽略。")])])])]),e._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[e._v("一些需要注意的点")]),e._v(" "),t("ul",[t("li",[e._v("部分指令只能在response或request中出现，且两边都能出现的时候意义不完全相同。")]),e._v(" "),t("li",[t("code",[e._v("no-cache")]),e._v("意思是必须验证，不代表不缓存。"),t("code",[e._v("no-store")]),e._v("代表不缓存。")]),e._v(" "),t("li",[t("code",[e._v("no-cache")]),e._v(", "),t("code",[e._v("must-revalidate")]),e._v(", "),t("code",[e._v("max-age=0")]),e._v("的区别。"),t("code",[e._v("no-cache")]),e._v("和"),t("code",[e._v("max-age")]),e._v("既可以在请求也可以响应中，"),t("code",[e._v("must-revalidate")]),e._v("只能在响应中。"),t("code",[e._v("no-cache")]),e._v("不论资源是否过期都要验证，"),t("code",[e._v("must-revalidate")]),e._v("只有资源过期时必须验证，"),t("code",[e._v("max-age=0")]),e._v("代表资源始终是过期的（response），或者表明请求希望得到的资源最大"),t("code",[e._v("age")]),e._v("为0（request）。")])])]),e._v(" "),t("h4",{attrs:{id:"expires-header"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#expires-header"}},[e._v("#")]),e._v(" Expires Header")]),e._v(" "),t("p",[e._v("Syntax:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Expires: <http-date>\n")])])]),t("p",[e._v("Example:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Expires: Wed, 21 Oct 2015 07:28:00 GMT\n")])])]),t("p",[e._v("Type: Response Header")]),e._v(" "),t("p",[e._v("值为一个HTTP-date timestamp，仅在响应中出现，设置该资源的过期时间，超过该时间视为stale。")]),e._v(" "),t("p",[e._v("如果值不是合法的HTTP-date timestamp，则视为该资源已经过期。")]),e._v(" "),t("p",[e._v("如果"),t("code",[e._v("Cache-Control")]),e._v("中设置了"),t("code",[e._v("max-age")]),e._v("或"),t("code",[e._v("s-maxage")]),e._v("，该字段被忽略。")]),e._v(" "),t("h4",{attrs:{id:"etag-header"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#etag-header"}},[e._v("#")]),e._v(" Etag Header")]),e._v(" "),t("p",[e._v("Syntax:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('ETag: W/"<etag_value>"\nETag: "<etag_value>"\n')])])]),t("p",[e._v("Examples:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('ETag: "33a64df551425fcc55e4d42a148795d9f25f89d4"\nETag: W/"0815"\n')])])]),t("p",[e._v("Type: Response Header")]),e._v(" "),t("p",[e._v("当前资源的Entity Tag，可以用于配合"),t("code",[e._v("If-Match")]),e._v(", "),t("code",[e._v("If-None-Match")]),e._v(", "),t("code",[e._v("Vary")]),e._v("来判断是不是同一资源。")]),e._v(" "),t("p",[t("code",[e._v("W/")]),e._v("表明使用Weak Validator。")]),e._v(" "),t("blockquote",[t("p",[e._v("Etags的生成方法没有在HTTP中指明，常用的方法包括对资源内容进行Hash，对last modification timestamp进行Hash，或者单纯设定一个修订版本号。")])]),e._v(" "),t("h4",{attrs:{id:"if-match-header"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#if-match-header"}},[e._v("#")]),e._v(" If-Match Header")]),e._v(" "),t("p",[e._v("Syntax:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("If-Match: <etag_value>\nIf-Match: <etag_value>, <etag_value>, …\n")])])]),t("p",[e._v("Examples:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('If-Match: "bfc13a64729c4290ef5b2c2730249c88ca92d82d"\nIf-Match: W/"67ab43", "54ed21", "7892dd"\nIf-Match: *\n')])])]),t("p",[e._v("Type: Request header")]),e._v(" "),t("p",[e._v("值为entity-tag，仅在请求中出现。当所请求资源的entity-tag匹配时，该请求才生效。如果没有匹配资源，或者"),t("code",[e._v("If-Match: *")]),e._v("但没有资源存在时，服务器不(MUST NOT)执行该请求，(MUST)返回"),t("code",[e._v("412 Precondition Failed")]),e._v("。")]),e._v(" "),t("p",[e._v("对于需要更新资源的请求(比如PUT)来说，只有当entity-tag匹配时才会更新资源。")]),e._v(" "),t("p",[e._v("如果一个请求在不考虑"),t("code",[e._v("If-Match")]),e._v("的情况下，就会返回"),t("code",[e._v("2xx/412")]),e._v("之外的状态，则忽略"),t("code",[e._v("If-Match")]),e._v("。(应该指的是"),t("code",[e._v("If-Match")]),e._v("的优先级比较低)")]),e._v(" "),t("p",[e._v("如果请求同时存在"),t("code",[e._v("If-Match + If-None-Match")]),e._v(" 或者 "),t("code",[e._v("If-Match + If-Modified-Since")]),e._v("，RFC2616中没有明确规定。")]),e._v(" "),t("blockquote",[t("p",[e._v("The result of a request having both an If-Match header field and either an If-None-Match or an If-Modified-Since header fields is undefined by this specification.")])]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("PS")]),e._v(" "),t("p",[e._v("在RFC2616中写明，服务器必须使用强验证来比较"),t("code",[e._v("If-Match")]),e._v("中的entity-tag：")]),e._v(" "),t("blockquote",[t("p",[e._v("A server MUST use the strong comparison function (see section 13.3.3) to compare the entity tags in If-Match.")])]),e._v(" "),t("p",[e._v("在MDN文档中，则说明如果加了"),t("code",[e._v("W/")]),e._v("前缀，则可以使用弱验证:")]),e._v(" "),t("blockquote",[t("p",[e._v("The comparison with the stored ETag uses the strong comparison algorithm, meaning two files are considered identical byte to byte only. This is weakened when the  W/ prefix is used in front of the ETag.")])]),e._v(" "),t("p",[e._v("可能后者是Mozilla的implementation，在RFC2616的examples里面没有加"),t("code",[e._v("W/")]),e._v("前缀的例子，上面的examples是用的MDN上的。")]),e._v(" "),t("p",[e._v("在缓存方面其实一般都是用"),t("code",[e._v("If-None-Match")]),e._v("。但是"),t("code",[e._v("If-Match")]),e._v("功能比较接近，所以也一并列出来了。")])]),e._v(" "),t("h4",{attrs:{id:"if-none-match-header"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#if-none-match-header"}},[e._v("#")]),e._v(" If-None-Match Header")]),e._v(" "),t("p",[e._v("Syntax:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("If-None-Match: <etag_value>\nIf-None-Match: <etag_value>, <etag_value>, …\n")])])]),t("p",[e._v("Examples:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('If-None-Match: "bfc13a64729c4290ef5b2c2730249c88ca92d82d"\nIf-None-Match: W/"67ab43", "54ed21", "7892dd"\nIf-None-Match: *\n')])])]),t("p",[e._v("Type: Request header")]),e._v(" "),t("p",[e._v("值为entity-tag，仅在请求中出现。当所请求资源的entity-tag没有匹配时，该请求才生效。如果存在匹配资源，或者"),t("code",[e._v("If-None-Match: *")]),e._v("且有资源存在时，服务器不(MUST NOT)执行该请求，且对于GET和HEAD请求应该(SHOULD)返回"),t("code",[e._v("304 Not Modified")]),e._v("并添加相应的缓存相关headers(特别是要添加"),t("code",[e._v("ETag")]),e._v(")，而对于其他请求方法(MUST)返回"),t("code",[e._v("412 Precondition Failed")]),e._v("。")]),e._v(" "),t("p",[e._v("对于需要更新资源的请求(比如PUT)来说，只有相应资源不存在时才会生效，可以用来避免客户端对已存在的资源进行更新。")]),e._v(" "),t("p",[e._v("如果一个请求的"),t("code",[e._v("If-None-Match")]),e._v("没有匹配到资源，则服务器必须(MUST)忽略该请求中的"),t("code",[e._v("If-Modified-Since")]),e._v("。也就是说，只要没有entity-tag匹配到，不管"),t("code",[e._v("If-Modified-Since")]),e._v("的结果如何，服务器就不能(MUST NOT)返回"),t("code",[e._v("304 Not Modified")]),e._v("。")]),e._v(" "),t("p",[e._v("如果一个请求在不考虑"),t("code",[e._v("If-None-Match")]),e._v("的情况下，就会返回"),t("code",[e._v("2xx/304")]),e._v("(应该还包括"),t("code",[e._v("412")]),e._v("，但是RFC2616上没写明)之外的状态，则忽略"),t("code",[e._v("If-None-Match")]),e._v("。(同样应该指的是"),t("code",[e._v("If-None-Match")]),e._v("的优先级比较低)")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("PS")]),e._v(" "),t("p",[e._v("在RFC2616中写明，服务器只能对GET和HEAD请求使用弱验证来比较"),t("code",[e._v("If-None-Match")]),e._v("中的entity-tag：")]),e._v(" "),t("blockquote",[t("p",[e._v("The weak comparison function can only be used with GET or HEAD requests.")])]),e._v(" "),t("p",[e._v("在MDN文档中，则只说明使用弱验证:")]),e._v(" "),t("blockquote",[t("p",[e._v("The comparison with the stored ETag uses the weak comparison algorithm.")])])]),e._v(" "),t("h4",{attrs:{id:"if-modified-since-header"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#if-modified-since-header"}},[e._v("#")]),e._v(" If-Modified-Since Header")]),e._v(" "),t("p",[e._v("Syntax:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("If-Modified-Since: <day-name>, <day> <month> <year> <hour>:<minute>:<second> GMT\n")])])]),t("p",[e._v("Examples:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("If-Modified-Since: Wed, 21 Oct 2015 07:28:00 GMT\n")])])]),t("p",[e._v("Type: Request header")]),e._v(" "),t("p",[e._v("仅在请求中出现，且只能在GET或HEAD中使用。如果请求的资源在给定时间后被修改，则像普通GET请求一样返回"),t("code",[e._v("200")]),e._v("。如果没有被修改，则返回"),t("code",[e._v("304 Not Modified")]),e._v("。")]),e._v(" "),t("p",[e._v("在和"),t("code",[e._v("If-None-Match")]),e._v("一起出现时，将被忽略。")]),e._v(" "),t("h4",{attrs:{id:"if-unmodified-since-header"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#if-unmodified-since-header"}},[e._v("#")]),e._v(" If-Unmodified-Since Header")]),e._v(" "),t("p",[e._v("Syntax:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("If-Unmodified-Since: <day-name>, <day> <month> <year> <hour>:<minute>:<second> GMT\n")])])]),t("p",[e._v("Examples:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("If-Unmodified-Since: Wed, 21 Oct 2015 07:28:00 GMT\n")])])]),t("p",[e._v("Type: Request header")]),e._v(" "),t("p",[e._v("仅在请求中出现。如果请求的资源在给定时间没有被修改，则服务器应该(SHOULD)当作没有"),t("code",[e._v("If-Unmodified-Since")]),e._v("存在一样处理该请求。如果在给定时间后有被修改，则服务器不(MUST NOT)处理该请求，并返回"),t("code",[e._v("412 Precondition Failed")]),e._v("。")]),e._v(" "),t("p",[e._v("如果一个请求在不考虑"),t("code",[e._v("If-Unmodified-Since")]),e._v("的情况下，就会返回"),t("code",[e._v("2xx/412")]),e._v("之外的状态，则忽略"),t("code",[e._v("If-Unmodified-Since")]),e._v("。")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("PS")]),e._v(" "),t("p",[e._v("在缓存方面其实一般都是用"),t("code",[e._v("If-Modified-Since")]),e._v("。但是"),t("code",[e._v("If-Unmodified-Since")]),e._v("功能比较接近，所以也一并列出来了。")])]),e._v(" "),t("h4",{attrs:{id:"last-modified-header"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#last-modified-header"}},[e._v("#")]),e._v(" Last-Modified Header")]),e._v(" "),t("p",[e._v("Syntax:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Last-Modified: <day-name>, <day> <month> <year> <hour>:<minute>:<second> GMT\n")])])]),t("p",[e._v("Example:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Last-Modified: Wed, 21 Oct 2015 07:28:00 GMT\n")])])]),t("p",[e._v("Type: Response Header")]),e._v(" "),t("p",[e._v("仅在响应中出现，表明源服务器上该资源的最后修改时间。可以用来验证资源是否是相同的，精确性比"),t("code",[e._v("ETag")]),e._v("低，大部分情况下仅作为备用机制。")]),e._v(" "),t("p",[e._v("对于该值的准确意义，与源服务器的实现方式和资源的类型有关。对于文件资源，可以是filesystem的last-modified time；对于数据库gateway，可以是记录的last-update timestamp等等。")]),e._v(" "),t("p",[e._v("源服务器不能(MUST NOT)把"),t("code",[e._v("Last-Modified")]),e._v("的值设置为比消息源(message origination，我理解为请求的时间)更晚的时间。如果得到的时间确实超过消息源时间，则必须(MUST)将"),t("code",[e._v("Last-Modified")]),e._v("设置为与消息源一样的时间。")]),e._v(" "),t("p",[t("code",[e._v("HTTP/1.1")]),e._v("应该(SHOULD)在任何可行的情况下，尽可能发送"),t("code",[e._v("Last-Modified")]),e._v(" Header。")]),e._v(" "),t("h4",{attrs:{id:"vary-header"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vary-header"}},[e._v("#")]),e._v(" Vary Header")]),e._v(" "),t("p",[e._v("Syntax:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Vary: *\nVary: <header-name>, <header-name>, ...\n")])])]),t("p",[e._v("Example:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Vary: User-Agent\n")])])]),t("p",[e._v("Type: Response Header")]),e._v(" "),t("p",[e._v("仅在响应中出现，表明在后续的请求中，要根据设置的Header来判断是否能使用该资源的缓存。")]),e._v(" "),t("p",[e._v("如果设置"),t("code",[e._v("Vary: *")]),e._v("，表明缓存系统无法通过Header来判断是否可以返回该资源，相当于每个不同的请求都不能使用该资源的缓存。")]),e._v(" "),t("p",[t("code",[e._v("HTTP/1.1")]),e._v("服务器对在所有可缓存的响应中都应该(SHOULD)包含"),t("code",[e._v("Vary")]),e._v(" Header。")]),e._v(" "),t("blockquote",[t("p",[e._v("大部分常见的会用到"),t("code",[e._v("Accept-Encoding")])])]),e._v(" "),t("h3",{attrs:{id:"expiration-model-todo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#expiration-model-todo"}},[e._v("#")]),e._v(" Expiration Model [TODO]")]),e._v(" "),t("ul",[t("li",[e._v("客户端发起请求，检查缓存是否命中：\n"),t("ul",[t("li",[e._v("若请求没有在缓存中命中，则直接向服务器转发请求，然后缓存响应资源。")]),e._v(" "),t("li",[e._v("若请求在缓存中命中，检查缓存是否fresh：\n"),t("ul",[t("li",[e._v("若fresh，则直接返回缓存资源，状态码"),t("code",[e._v("200")])]),e._v(" "),t("li",[e._v("若stale，则通过在请求中添加"),t("code",[e._v("If-None-Match")]),e._v("向服务器请求检查资源是否fresh：\n"),t("ul",[t("li",[e._v("若返回"),t("code",[e._v("304 Not Modified")]),e._v("，则缓存重置资源"),t("code",[e._v("Age")]),e._v("，并将缓存资源返回给客户端")]),e._v(" "),t("li",[e._v("若返回"),t("code",[e._v("200")]),e._v("，则缓存新的资源，并返回给客户端")])])])])])])])]),e._v(" "),t("p",[e._v("资源“保鲜”时长：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("freshness_lifetime = `max-age` || (`Expires` - `Date`) || ((`Date` - `Last-Modified`) * 10%)\n")])])]),t("p",[e._v("资源过期时间：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("expiration_time = response_time + freshness_lifetime - current_age\n")])])]),t("p",[t("code",[e._v("response_time")]),e._v("表示客户端接收到此响应的时间点。")]),e._v(" "),t("h3",{attrs:{id:"validation-model-todo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#validation-model-todo"}},[e._v("#")]),e._v(" Validation Model [TODO]")]),e._v(" "),t("h4",{attrs:{id:"last-modified-etag"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#last-modified-etag"}},[e._v("#")]),e._v(" Last-Modified / Etag")]),e._v(" "),t("h4",{attrs:{id:"weak-and-strong-validators"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#weak-and-strong-validators"}},[e._v("#")]),e._v(" Weak and Strong Validators")]),e._v(" "),t("h2",{attrs:{id:"references"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[e._v("#")]),e._v(" References")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching",target:"_blank",rel:"noopener noreferrer"}},[e._v("HTTP caching | MDN"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control",target:"_blank",rel:"noopener noreferrer"}},[e._v("Cache-Control | MDN"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("HTTP/1.1: Caching in HTTP - RFC2616"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("HTTP/1.1: Header Field Definitions - RFC2616"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://en.wikipedia.org/wiki/HTTP_ETag",target:"_blank",rel:"noopener noreferrer"}},[e._v("HTTP ETag - WikiPedia"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.cnblogs.com/chyingp/p/no-cache-vs-must-revalidate.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("web性能优化之：no-cache与must-revalidate深入探究"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"写在后面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#写在后面"}},[e._v("#")]),e._v(" 写在后面")]),e._v(" "),t("p",[e._v("研二快结束了，这一两个月在找暑期实习。")]),e._v(" "),t("p",[e._v("在面腾讯SNG前端的时候，对缓存这部分好像挺重视的。但是当时还没怎么好好看过这部分内容，基本没答上什么，二面面试官就让我趁这两个月回去好好看看。（听这话的意思好像是在说我已经稳了，但是没想到HR面之后已经过了一个月，还是没有任何消息……好慌😅）")]),e._v(" "),t("p",[e._v("实习的事先不论，想好好做前端的话，这些该补的还是要补上。")]),e._v(" "),t("p",[e._v("----update20180601")]),e._v(" "),t("p",[e._v("拿到腾讯SNG的前端实习offer啦，下个月去深圳实习~")])],1)}),[],!1,null,null,null);a.default=_.exports}}]);